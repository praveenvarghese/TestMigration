/*!
 * @AIMMS_FILE=models/Bugs/GL2428-SmallExample2428/SmallExample2428.aimms
 */

scenario(
	"c3741 - WebUI crashed on a page having table with large data, totals and filtering applied.",
	() => {
		loadPage("Main Project/c3741");

		// Assert data shown on the table.
		const expected_values_with_table_initial_load = [
			[
				"689.00",
				"763.00",
				"-788.00",
				"881.00",
				"0.00",
				"-276.00",
				"798.00",
				"575.00",
				"-435.00",
				"149.00",
			],
			[
				"-44.00",
				"785.00",
				"696.00",
				"-432.00",
				"613.00",
				"-756.00",
				"828.00",
				"-886.00",
				"447.00",
				"-581.00",
			],
			[
				"-871.00",
				"-9.00",
				"30.00",
				"564.00",
				"787.00",
				"233.00",
				"764.00",
				"-519.00",
				"375.00",
				"-601.00",
			],
			[
				"696.00",
				"-793.00",
				"163.00",
				"427.00",
				"36.00",
				"-321.00",
				"-137.00",
				"-178.00",
				"839.00",
				"-601.00",
			],
			[
				"470.00",
				"746.00",
				"101.00",
				"1,440.00",
				"1,436.00",
				"-1,120.00",
				"2,253.00",
				"-1,008.00",
				"1,226.00",
				"-1,634.00",
			],
			[
				"117.50",
				"186.50",
				"25.25",
				"360.00",
				"359.00",
				"-280.00",
				"563.25",
				"-252.00",
				"306.50",
				"-408.50",
			],
			["4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00"],
			[
				"-871.00",
				"-793.00",
				"-788.00",
				"-432.00",
				"0.00",
				"-756.00",
				"-137.00",
				"-886.00",
				"-435.00",
				"-601.00",
			],
			[
				"696.00",
				"785.00",
				"696.00",
				"881.00",
				"787.00",
				"233.00",
				"828.00",
				"575.00",
				"839.00",
				"149.00",
			],
			[
				"38.00",
				"235.00",
				"750.00",
				"646.00",
				"452.00",
				"-150.00",
				"-886.00",
				"-718.00",
				"-26.00",
				"283.00",
			],
			[
				"-346.00",
				"668.00",
				"-286.00",
				"-433.00",
				"51.00",
				"628.00",
				"-733.00",
				"-670.00",
				"-427.00",
				"803.00",
			],
			[
				"598.00",
				"-850.00",
				"141.00",
				"-734.00",
				"242.00",
				"-450.00",
				"87.00",
				"466.00",
				"-593.00",
				"125.00",
			],
			[
				"290.00",
				"53.00",
				"605.00",
				"-521.00",
				"745.00",
				"28.00",
				"-1,532.00",
				"-922.00",
				"-1,046.00",
				"1,211.00",
			],
			[
				"96.67",
				"17.67",
				"201.67",
				"-173.67",
				"248.33",
				"9.33",
				"-510.67",
				"-307.33",
				"-348.67",
				"403.67",
			],
			["3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00"],
			[
				"-346.00",
				"-850.00",
				"-286.00",
				"-734.00",
				"51.00",
				"-450.00",
				"-886.00",
				"-718.00",
				"-593.00",
				"125.00",
			],
			[
				"598.00",
				"668.00",
				"750.00",
				"646.00",
				"452.00",
				"628.00",
				"87.00",
				"466.00",
				"-26.00",
				"803.00",
			],
			[
				"245.00",
				"705.00",
				"-645.00",
				"-1.00",
				"184.00",
				"-98.00",
				"-456.00",
				"300.00",
				"-809.00",
				"878.00",
			],
			[
				"-809.00",
				"-621.00",
				"-5.00",
				"-496.00",
				"856.00",
				"-653.00",
				"392.00",
				"-317.00",
				"-295.00",
				"73.00",
			],
			[
				"-573.00",
				"-380.00",
				"876.00",
				"-346.00",
				"283.00",
				"401.00",
				"-235.00",
				"484.00",
				"851.00",
				"-591.00",
			],
			[
				"492.00",
				"71.00",
				"693.00",
				"-433.00",
				"124.00",
				"-375.00",
				"143.00",
				"873.00",
				"-770.00",
				"-118.00",
			],
			[
				"-643.00",
				"300.00",
				"-261.00",
				"-437.00",
				"185.00",
				"155.00",
				"-900.00",
				"40.00",
				"-779.00",
				"844.00",
			],
			[
				"-1,288.00",
				"75.00",
				"658.00",
				"-1,713.00",
				"1,632.00",
				"-570.00",
				"-1,056.00",
				"1,380.00",
				"-1,802.00",
				"1,086.00",
			],
			[
				"-257.60",
				"15.00",
				"131.60",
				"-342.60",
				"326.40",
				"-114.00",
				"-211.20",
				"276.00",
				"-360.40",
				"217.20",
			],
			["5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00"],
			[
				"-809.00",
				"-621.00",
				"-645.00",
				"-496.00",
				"124.00",
				"-653.00",
				"-900.00",
				"-317.00",
				"-809.00",
				"-591.00",
			],
			[
				"492.00",
				"705.00",
				"876.00",
				"-1.00",
				"856.00",
				"401.00",
				"392.00",
				"873.00",
				"851.00",
				"878.00",
			],
			[
				"88.00",
				"-238.00",
				"555.00",
				"465.00",
				"195.00",
				"-580.00",
				"328.00",
				"-686.00",
				"-265.00",
				"626.00",
			],
			[
				"742.00",
				"-569.00",
				"-893.00",
				"-175.00",
				"302.00",
				"-174.00",
				"-713.00",
				"862.00",
				"-722.00",
				"-49.00",
			],
			[
				"360.00",
				"766.00",
				"-701.00",
				"-34.00",
				"164.00",
				"371.00",
				"469.00",
				"-326.00",
				"-807.00",
				"147.00",
			],
		];

		findWidget("PData")
			.getGridValues()
			.should.be.shallowDeepEqual(expected_values_with_table_initial_load);

		// Using Down-Arrow key, scroll down the table.
		findWidget("PData")
			.getCell(15, 5)
			.click()
			.pressKeys([
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
				SPECIAL_KEYS.arrow_down,
			]);

		// Assert data shown on the table.
		const expected_values_with_table_scrolled = [
			[
				"689.00",
				"763.00",
				"-788.00",
				"881.00",
				"0.00",
				"-276.00",
				"798.00",
				"575.00",
				"-435.00",
				"149.00",
			],
			[
				"-44.00",
				"785.00",
				"696.00",
				"-432.00",
				"613.00",
				"-756.00",
				"828.00",
				"-886.00",
				"447.00",
				"-581.00",
			],
			[
				"-871.00",
				"-9.00",
				"30.00",
				"564.00",
				"787.00",
				"233.00",
				"764.00",
				"-519.00",
				"375.00",
				"-601.00",
			],
			[
				"696.00",
				"-793.00",
				"163.00",
				"427.00",
				"36.00",
				"-321.00",
				"-137.00",
				"-178.00",
				"839.00",
				"-601.00",
			],
			[
				"470.00",
				"746.00",
				"101.00",
				"1,440.00",
				"1,436.00",
				"-1,120.00",
				"2,253.00",
				"-1,008.00",
				"1,226.00",
				"-1,634.00",
			],
			[
				"117.50",
				"186.50",
				"25.25",
				"360.00",
				"359.00",
				"-280.00",
				"563.25",
				"-252.00",
				"306.50",
				"-408.50",
			],
			["4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00", "4.00"],
			[
				"-871.00",
				"-793.00",
				"-788.00",
				"-432.00",
				"0.00",
				"-756.00",
				"-137.00",
				"-886.00",
				"-435.00",
				"-601.00",
			],
			[
				"696.00",
				"785.00",
				"696.00",
				"881.00",
				"787.00",
				"233.00",
				"828.00",
				"575.00",
				"839.00",
				"149.00",
			],
			[
				"38.00",
				"235.00",
				"750.00",
				"646.00",
				"452.00",
				"-150.00",
				"-886.00",
				"-718.00",
				"-26.00",
				"283.00",
			],
			[
				"-346.00",
				"668.00",
				"-286.00",
				"-433.00",
				"51.00",
				"628.00",
				"-733.00",
				"-670.00",
				"-427.00",
				"803.00",
			],
			[
				"598.00",
				"-850.00",
				"141.00",
				"-734.00",
				"242.00",
				"-450.00",
				"87.00",
				"466.00",
				"-593.00",
				"125.00",
			],
			[
				"290.00",
				"53.00",
				"605.00",
				"-521.00",
				"745.00",
				"28.00",
				"-1,532.00",
				"-922.00",
				"-1,046.00",
				"1,211.00",
			],
			[
				"96.67",
				"17.67",
				"201.67",
				"-173.67",
				"248.33",
				"9.33",
				"-510.67",
				"-307.33",
				"-348.67",
				"403.67",
			],
			["3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00", "3.00"],
			[
				"-346.00",
				"-850.00",
				"-286.00",
				"-734.00",
				"51.00",
				"-450.00",
				"-886.00",
				"-718.00",
				"-593.00",
				"125.00",
			],
			[
				"598.00",
				"668.00",
				"750.00",
				"646.00",
				"452.00",
				"628.00",
				"87.00",
				"466.00",
				"-26.00",
				"803.00",
			],
			[
				"245.00",
				"705.00",
				"-645.00",
				"-1.00",
				"184.00",
				"-98.00",
				"-456.00",
				"300.00",
				"-809.00",
				"878.00",
			],
			[
				"-809.00",
				"-621.00",
				"-5.00",
				"-496.00",
				"856.00",
				"-653.00",
				"392.00",
				"-317.00",
				"-295.00",
				"73.00",
			],
			[
				"-573.00",
				"-380.00",
				"876.00",
				"-346.00",
				"283.00",
				"401.00",
				"-235.00",
				"484.00",
				"851.00",
				"-591.00",
			],
			[
				"492.00",
				"71.00",
				"693.00",
				"-433.00",
				"124.00",
				"-375.00",
				"143.00",
				"873.00",
				"-770.00",
				"-118.00",
			],
			[
				"-643.00",
				"300.00",
				"-261.00",
				"-437.00",
				"185.00",
				"155.00",
				"-900.00",
				"40.00",
				"-779.00",
				"844.00",
			],
			[
				"-1,288.00",
				"75.00",
				"658.00",
				"-1,713.00",
				"1,632.00",
				"-570.00",
				"-1,056.00",
				"1,380.00",
				"-1,802.00",
				"1,086.00",
			],
			[
				"-257.60",
				"15.00",
				"131.60",
				"-342.60",
				"326.40",
				"-114.00",
				"-211.20",
				"276.00",
				"-360.40",
				"217.20",
			],
			["5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00", "5.00"],
			[
				"-809.00",
				"-621.00",
				"-645.00",
				"-496.00",
				"124.00",
				"-653.00",
				"-900.00",
				"-317.00",
				"-809.00",
				"-591.00",
			],
			[
				"492.00",
				"705.00",
				"876.00",
				"-1.00",
				"856.00",
				"401.00",
				"392.00",
				"873.00",
				"851.00",
				"878.00",
			],
			[
				"88.00",
				"-238.00",
				"555.00",
				"465.00",
				"195.00",
				"-580.00",
				"328.00",
				"-686.00",
				"-265.00",
				"626.00",
			],
			[
				"742.00",
				"-569.00",
				"-893.00",
				"-175.00",
				"302.00",
				"-174.00",
				"-713.00",
				"862.00",
				"-722.00",
				"-49.00",
			],
			[
				"360.00",
				"766.00",
				"-701.00",
				"-34.00",
				"164.00",
				"371.00",
				"469.00",
				"-326.00",
				"-807.00",
				"147.00",
			],
		];

		findWidget("PData")
			.getGridValues()
			.should.be.shallowDeepEqual(expected_values_with_table_scrolled);

		// Refresh the page
		pageRefresh();

		findWidget("PData")
			.getGridValues()
			.should.be.shallowDeepEqual(expected_values_with_table_initial_load);
	}
);
